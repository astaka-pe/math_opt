# 2. Pythonによる線形最適化

## 2.1 線形最適化問題入門

**線形最適化問題（linear optimization problem, LP）**：

- 目的関数が線形関数
- 制約式が全て線形等式と線形不等式

である数理最適化問題

**自由変数**：制約がなくどんな値も取りうる変数

- 2つの非負変数で表せる

### 等式条件と不等式条件

不等式条件は非負変数（**スラック変数**）を導入することで等式条件に変換できる

### LPの基本定理

任意のLPは以下の3つのうち1つだけの性質を持つ

1. 最適解を持つ
2. 非有界である（実行可能領域が開いていて、無限に最大化・最小化できる）
3. 実行不可能である（全ての[不]等式条件を満たす集合がない）

## 2.2 双対性

PuLPで得られた最適解の確認

- 実行可能解であることの確認：すべての不等式制約を満足するかどうか
- 満たすならば、最適解の候補（最適値の**下界**）であるといえる（最大化問題の場合）
  - 目的関数は現状の最適解以上の値である

`最適値の上界 = 最適値の下界` となれば、その候補が最適値であることを示せる

$$
\text{maximize}(150 x_1 + 200 x_2 + 300 x_3)\\
\begin{align*}
3 x_1 &+& x_2 &+& 2 x_3 &\leq& 60 \\
x_1 &+& 3 x_2 && &\leq& 36 \\
&& 2 x_2 &+& 4 x_3 &\leq& 48 \\
x_1, x_2, x_3 \geq 0
\end{align*}
$$

の最適値の上界を最小化する問題（**双対問題**）は、

$$
\text{minimize}(60 y_1 + 36 y_2 + 48 y_3)\\
\begin{align*}
3 y_1 &+& y_2 &&  &\geq& 150 \\
y_1 &+& 3 y_2 &+& 2 y_3 &\geq& 200 \\
2 y_1 && &+& 4 y_3 &\geq& 300 \\
y_1, y_2, y_3 \geq 0
\end{align*}
$$

として定義できる（主問題の各行をそれぞれ $y_1, y_2, y_3$ 倍して片々足し合わせれば導出できる）

主問題と双対問題の最適値が一致するような解が見つかれば、それらは共にそれぞれの最適解である

- 最適解の確認方法
  - 主問題の最適値に確信が持てなければ、双対問題を解き、それらが一致すれば最適解

## 双対定理

**主問題と双対問題がどちらも実行可能ならば、いずれも最適解を持ち、最適値は一致する。さらに、主問題が最適解を持つための必要十分条件は双対問題が最適解を持つことである。**

## 2.3 アルゴリズム

### 2.3.1 シンプレックス法

仮定

- 不等式の右側成分が全て非負（原点が実行可能解である）

準備

- 目的関数を新たな変数 $x_f$ で表し、不等式条件それぞれに**スラック変数***を導入して等式系に書き換える
- 導入したスラック変数を左辺に残して等式系を変形する（**シンプレックス辞書**）
  - 基底変数：等式の左側の変数
  - 非基底変数：等式の右側の変数

基底解の求め方

- 任意の辞書について、非基底変数の値を0に定めて基底変数の値を決めたもの

概要

- 初期辞書に対応する基底解からスタートし、目的関数値を改善するように、辞書と対応する基底解を随時更新していく

1. 最適性のチェック

    - 目的関数の等式中で係数が正となる非基底変数 $x_1$ を1つ選ぶ（**入る変数**）
    - 選べないなら基底解は最適
2. 非有界性チェック

    - 1で選んだ非基底変数 $x_1$ を0に保ったまま入る変数を0から $\theta$ へ増やしたい（そうすれば目的関数値も増加する）
    - どこまで増やせるかを辞書から読み取る
    - 基底変数の非負条件から連立不等式を解く
    - $\theta$ がもとまらなければ非有界である（終了）
3. 辞書と対応する基底解の更新

    - 新しい基底解は、$\theta$ が決まれば求められる
    - 非基底変数の値は0でなければいけない（$x_1$ は非基底変数でなくなる）
    - 2で連立不等式が解ければ、新たに0に変化する基底変数が生じるので、これを非基底変数にする（**出る変数**）

問題点

1. 右辺が負の場合どうするか？

    - 単位ベクトルを用いた補助問題（必ず実行可能）を解く
    - 補助問題の最適値によって元の問題が実行可能であるか判断できる（**2段階シンプレックス法**）
2. 必ず終了するか？

    - 目的関数値が増加している場合は問題ない
    - 目的関数値が変化しない場合、同じ辞書が現れうる（**退化**したピボット演算、辞書の**巡回**）
    - 最小添字規則により、巡回を避ける
      - 出る変数、入る変数の選択時には候補変数の添字が最小のものを選ぶ
3. 計算時間は？

    - 指数オーダー
    - 入る変数と出る変数の選択（**ピボット選択規則**）が計算効率に大きく左右する
      - 最大係数規則
      - 最大改善規則
      - 最急枝規則


### 2.3.2 内点法