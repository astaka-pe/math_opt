# 4. 割引クーポンキャンペーンの効果最大化

## 4.1 導入

予算を100万円として、全会員に3種類のいずれかのパターンのDMを送付する：

1. セールのチラシのみ
2. セールのチラシと1000円のクーポン
3. セールのチラシと2000円のクーポン

各パターンのDMを類似した来店傾向のセグメントごとに10%以上ずつ送付する
（継続的に施策が続くことを前提に全体を最適化する）

**予算と送付率の制約のもとで、来客数を最大化するようなDMの送付方法を決定する**

### 利用できるデータ

- 5000人の会員情報
  - 年齢区分
  - 昨年度来店回数区分
  - 会員セグメント
- セグメント情報
  - DMを受け取った時に来店する確率
- DMを受け取った時に来店するかどうかのアンケート（一部）

制約（10%）や予算（100万円）を変化させたときの投資対効果の変化についても、数理モデルを用いて評価する

## 4.2 課題整理

- 数理モデルによる決定事項
  - (1) 各会員に対してどのDMを送付するか

- 送付するDMの数
  - (2) 各会員に対していずれか1パターン

- キャンペーンの目的
  - (3) クーポン付与による来客増加数を最大化

- キャンペーン予算
  - (4) 会員の予算消費期待値の合計が100万円以下

- 次回以降のキャンペーンで利用する来店率の収集
  - セグメントは**年齢区分**と**昨年度来店回数区分**の組み合わせ
  - (5) 各パターンのDMをそれぞれのセグメントに属する会員の10%以上に送付

## 4.3 データ理解

[EDA](eda.ipynb)

どのセグメントの会員に対してクーポンを送付すれば集客効果を最大化できるか？

## 4.4 数理モデリングと実装

### モデリング1: 会員個別送付モデル

[実装](model1.py)

- 会員に対してどのDMを送付するかを表現する変数を定義
- 会員の来店率をセグメントごとに見積もる（同セグメントに属する会員ならばどの会員に送付しても来店率が変わらない、という前提）
- 決定変数の数が多い

### モデリング2: セグメント送付モデル

[実装](model2.py)

- 各セグメントに対してそれぞれのパターンのDMをどの程度送付するか
- 各セグメントに対するDMの送付率を表現する変数を定義
- 決定変数の数が少ない

モデリング1と2では僅かに送付率や送付数が異なる

- モデリング1: 各会員へ送付するかどうかの**離散変数**を決定変数とした
- モデリング2: セグメントへの送付率（**連続変数**）を決定変数とした

数理モデルの解きやすさ

- 決定変数の数が少ないほど時間効率が良い
- 決定変数が連続変数の方が解きやすい

## 4.5 結果の評価

[jupyter notebook](result_analysis.ipynb)

### 会員に対する施策の公平性の評価

昨年度1回以上来店した会員には最低限の10%しかクーポンが送付されていない

- クーポンがなくても来店してくれる会員に対する費用は無駄とみなされている

セグメント間での送付率に偏りを減らす方法

- 各セグメントへの送付率の下限値をできるだけ大きくする（**[送付率下限値最大化モデル](model3.py)**）
  - 偏りを減らすほど期待来店数増分は減少する（トレードオフ）
- 来店回数が3以上の会員には必ずいずれかのクーポンを付与する

要件に対して柔軟に対応できるのが数理モデリングによる最適化のメリット

### 投資対効果の評価

**キャンペーン予算を変化させた場合の投資対効果**がどのように変化するかを評価する

[実装](model4.py)

- CPAはキャンペーン費用を増加させることで急速に改善し、一定費用をすぎると緩やかに悪化する
- 利益を確保したい → CPAが最安になる予算を採用
- 来客数を増やしたい → CPAを確認しつつ予算を最適値よりも増加させる

## 4.6 まとめ

- 同じ問題でも複数の形でモデリングできる
- モデリングの形によって問題の解きやすさが異なる
- 変数が少なくできる場合には少なくする
- 連続変数と離散変数どちらも利用できる場合には**連続変数**を利用
- **費用対効果**や**公平性**の観点で結果を評価し、モデルをブラッシュアップ
- **施策のパラメータ**を変化させながら結果を評価